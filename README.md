#### facerecognition_service_MISiS_2023
MISiS prj. Fall 2023. Services subject. For robot project

## Пример создания и работы с сервисом

В файле `service.py` определён базовый класс взаимодействия сервисов.
Сервис распознавания лиц запускается из `run.py`, который используется класс `ServiceDF`, определённый в `df_service.py`.
Здесь переопределены функции основной работы (`_do_job`) и обработки запросов (`_request_handler`). При этом в процессе распознавания используется модуль `Camera` из файла `cam.py`.

## API сервиса

Помимо зарезервированных команд (`disable`, `enable`, `close`, `restart`) сервис поддерживает следующие специфичные команды:

* `getFrame` - возвращает RGB кадр в base64 формате.

* `getDepth` - возвращает Grayscale кадр в base64 формате.

* `getFace` - возвращает часть кадра с лицом, если оно есть, или кадр целиком, если лица нет, в base64 формате.

* `getRect` - возвращает координаты прямоугольника, соответствующему лицу на кадре, в формате [x, y, width, height] (координаты будут нулями, если лица на кадре не обнаружено).

* `applyThreshold_<value>` - применяет новое значение порога `<value>`, если оно в пределах (0., 1.] (по умолчанию порог 0.67). Возвращает "ok", если был установлен порог, иначе "failed".

* `startTracking` - сервис начинает отслеживание персоны. Если удалось определить лицо возвращает "ok", иначе "failed".

* `target` - аналогично getRect. Возвращает "empty", если персона для отслеживания не определена.

* `stopTracking` - прекращает отслеживание персоны. Всегда возвращает "ok".

* `applyGrayscale` - переводит обработку кадра в градации серого. Возвращает "ok".

* `applyRgb` - переводит обработку кадра в RGB (используется по умолчанию). Возвращает "ok".

* `getThreshold` - возвращает текущее значение порога определения лица.

* `getColorMap` - возвращает текущий режим цветового пространства для обработки: "rgb" или "gray".
